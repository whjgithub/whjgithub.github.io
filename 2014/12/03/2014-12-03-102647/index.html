<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>HTML+CSS+JS实现的贪吃蛇游戏&lt;二&gt;（完） | WHJ&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="通过上一部分的分析，我们已经完成了游戏的地图和基本的游戏元素，其主要的思想就是：通过js的DOM编程来动态添加和修改html元素和其属性，然后通过css来控制其界面的显示。现在我们需要进一步的深入，来解释后面几个逻辑的具体实现方法。">
<meta property="og:type" content="article">
<meta property="og:title" content="HTML+CSS+JS实现的贪吃蛇游戏<二>（完）">
<meta property="og:url" content="http://yoursite.com/2014/12/03/2014-12-03-102647/">
<meta property="og:site_name" content="WHJ's blog">
<meta property="og:description" content="通过上一部分的分析，我们已经完成了游戏的地图和基本的游戏元素，其主要的思想就是：通过js的DOM编程来动态添加和修改html元素和其属性，然后通过css来控制其界面的显示。现在我们需要进一步的深入，来解释后面几个逻辑的具体实现方法。">
<meta property="og:image" content="http://whj-img.qiniudn.com/tanchishe_bug.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HTML+CSS+JS实现的贪吃蛇游戏<二>（完）">
<meta name="twitter:description" content="通过上一部分的分析，我们已经完成了游戏的地图和基本的游戏元素，其主要的思想就是：通过js的DOM编程来动态添加和修改html元素和其属性，然后通过css来控制其界面的显示。现在我们需要进一步的深入，来解释后面几个逻辑的具体实现方法。">

  
    <link rel="alternative" href="/atom.xml" title="WHJ&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="http://whj-img.qiniudn.com/2014-11-03_145609.png">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">WHJ</a></h1>
		</hgroup>

		
		<p class="header-subtitle">WHJ&#39;s Heroic Joker</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/about">关于作者</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/whjgithub" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud">
						<a href="/tags/javascript/" style="font-size: 15.00px;">javascript</a><a href="/tags/python/" style="font-size: 15.00px;">python</a><a href="/tags/原创/" style="font-size: 15.00px;">原创</a><a href="/tags/数据结构/" style="font-size: 15.00px;">数据结构</a><a href="/tags/笔记/" style="font-size: 20.00px;">笔记</a><a href="/tags/随笔/" style="font-size: 10.00px;">随笔</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://chenpengdsp.com">CP师兄的博客</a>
			        
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://whj-img.qiniudn.com/2014-11-03_145609.png">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">WHJ</a></h1>
			</hgroup>
			
			<p class="header-subtitle">WHJ&#39;s Heroic Joker</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/about">关于作者</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/whjgithub" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <article id="post-2014-12-03-102647" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/12/03/2014-12-03-102647/" class="article-date">
  	<time datetime="2014-12-03T02:26:47.000Z" itemprop="datePublished">Dec 3 2014</time>
</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/原创/">原创</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      HTML+CSS+JS实现的贪吃蛇游戏&lt;二&gt;（完）
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>　　通过上一部分的分析，我们已经完成了游戏的地图和基本的游戏元素，其主要的思想就是：通过js的DOM编程来动态添加和修改html元素和其属性，然后通过css来控制其界面的显示。现在我们需要进一步的深入，来解释后面几个逻辑的具体实现方法。<br><a id="more"></a></p>
<h2 id="第三步和第四步">第三步和第四步</h2>
<p>　　这里我们把三、四两步放在一起来考虑。仔细想一想，蛇动起来后肯定会碰到各种东西，比如我们设置的食物，还有各个边界，所以我们在运动的过程中就要来考虑判定的机制。大致的方向我们有了，我们就来考虑细部的解决方法。<br>　　第一个要做的让蛇动起来，也就是让蛇在非身体的三个方向上移动一格，单纯考虑在空地上移动的话，我们可以这样来做：我们去掉蛇身体的最后一截，然后把下一格放入蛇的头部。我们都知道蛇吃到食物是要变长的，所以如果我们判定到下一步格子里有食物，那我们就不用去掉最后一截了，只要直接在头部加一截就好了。基本方法有了，那我们怎么知道玩家控制的蛇下一步是去哪？大家肯定说：按哪个方向键就去哪呗！是的，玩过的都知道，那么我们怎么才能实现？这个过程可以理解为对键盘按键的响应，我们捕获按键，并获得其值，然后判断并反应到程序中。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.step = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>{</div><div class="line">	<span class="comment">//判断现在是否在暂停状态</span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.pause) {</div><div class="line">		<span class="keyword">this</span>.talk(<span class="string">"暂停啦，休息一下~"</span>);</div><div class="line">		<span class="built_in">window</span>.clearInterval(<span class="keyword">this</span>.snakeTimer);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.brakeTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.brakeTimers[i]);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.skateTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.skateTimers[i]);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">	<span class="comment">//取得现在的头节点</span></div><div class="line">	<span class="keyword">var</span> headX = <span class="keyword">this</span>.snake_pos[<span class="number">0</span>][<span class="number">0</span>];</div><div class="line">	<span class="keyword">var</span> headY = <span class="keyword">this</span>.snake_pos[<span class="number">0</span>][<span class="number">1</span>];</div><div class="line">	<span class="comment">//加入一些随机元素</span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.len &gt;= <span class="number">10</span> && <span class="keyword">this</span>.brakeTimers.length &lt;= <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.len /<span class="number">2</span>)) {</div><div class="line">			<span class="keyword">this</span>.brakeTimers.push(<span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">				<span class="keyword">this</span>.addObject(<span class="string">"brake"</span>).bind(<span class="keyword">this</span>)</div><div class="line">			}, randNum(<span class="number">5000</span>, <span class="number">50000</span>)));</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.skateTimers.length &lt;= <span class="number">5</span> || <span class="keyword">this</span>.skateTimers.length &gt;=  <span class="number">35</span>) {</div><div class="line">		<span class="keyword">this</span>.skateTimers.push(<span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">			<span class="keyword">this</span>.addObject(<span class="string">"skate"</span>).bind(<span class="keyword">this</span>)</div><div class="line">		}, randNum(<span class="number">5000</span>, <span class="number">50000</span>)));</div><div class="line">	}		</div><div class="line">	<span class="comment">//根据方向取得下一步头节点坐标</span></div><div class="line">	<span class="keyword">switch</span> (<span class="keyword">this</span>.directionkey){</div><div class="line">		<span class="keyword">case</span> <span class="number">37</span>:<span class="comment">//左下右上</span></div><div class="line">			headY -= <span class="number">1</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> <span class="number">38</span>:</div><div class="line">			headX -= <span class="number">1</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> <span class="number">39</span>:</div><div class="line">			headY += <span class="number">1</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> <span class="number">40</span>:</div><div class="line">			headX += <span class="number">1</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">	}</div><div class="line">	<span class="comment">//针对头节点撞墙和撞自己</span></div><div class="line">	<span class="keyword">if</span>(headX &lt; <span class="number">0</span> || headX &gt;= <span class="keyword">this</span>.HEIGHT || headY &lt; <span class="number">0</span> || headY &gt;= <span class="keyword">this</span>.WIDTH || <span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"cover"</span> || <span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"block"</span> ){			</div><div class="line">		<span class="comment">//撞墙后则进入非正常状态，为暂停和死亡的区分</span></div><div class="line">		<span class="keyword">this</span>.status = <span class="literal">false</span>;</div><div class="line">		<span class="keyword">this</span>.talk(<span class="string">"你撞到东西啦~游戏结束！"</span>);</div><div class="line">		<span class="comment">//设置最高分</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.score &gt;= <span class="built_in">parseInt</span>($(<span class="string">"best_score"</span>).innerHTML)) {</div><div class="line">			$(<span class="string">"best_score"</span>).innerHTML = <span class="keyword">this</span>.score;</div><div class="line">		}			</div><div class="line">		$(<span class="string">"btnStart"</span>).removeAttribute(<span class="string">"disabled"</span>);</div><div class="line">		$(<span class="string">"btnStart"</span>).style.color = <span class="string">"#000"</span>;</div><div class="line">		<span class="comment">//清除定时器</span></div><div class="line">		<span class="built_in">window</span>.clearInterval(<span class="keyword">this</span>.snakeTimer);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.brakeTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.brakeTimers[i]);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.skateTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.skateTimers[i]);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">	<span class="comment">//捡到刹车</span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"brake"</span> ) {</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.speed &gt;= <span class="number">20</span>) {</div><div class="line">			<span class="keyword">this</span>.speed -= <span class="number">10</span>;</div><div class="line">			<span class="keyword">this</span>.move();</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"慢一点，步子太快会扯着蛋~"</span>);</div><div class="line">		}<span class="keyword">else</span>{</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"已经很慢啦，不能再减速了~"</span>);</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//遭遇滑板</span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"skate"</span> ) {</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.speed &lt;= <span class="number">50</span>) {</div><div class="line">			<span class="keyword">this</span>.speed += <span class="number">10</span>;</div><div class="line">			<span class="keyword">this</span>.move();</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"带你飞~"</span>);</div><div class="line">		} <span class="keyword">else</span>{</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"不能再快啦~"</span>);</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//如果吃到食物</span></div><div class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"food"</span>){</div><div class="line">		<span class="keyword">this</span>.talk(<span class="string">"吃到食物啦~"</span>);</div><div class="line">		<span class="keyword">this</span>.score += <span class="number">1</span>;</div><div class="line">		$(<span class="string">"score"</span>).innerHTML = <span class="keyword">this</span>.score;</div><div class="line">		<span class="comment">//清除旧食物，添加新食物，加分</span></div><div class="line">		<span class="keyword">this</span>.carrier[headX][headY] = <span class="string">''</span>;</div><div class="line">		<span class="keyword">this</span>.gridElems[headX][headY].className = <span class="string">""</span>;</div><div class="line">		<span class="keyword">this</span>.addObject(<span class="string">"food"</span>);</div><div class="line">		<span class="comment">//满足一定条件则加速，并重置定时器</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.len % <span class="number">4</span> == <span class="number">0</span> && <span class="keyword">this</span>.speed &lt; <span class="number">60</span>) {</div><div class="line">			<span class="keyword">this</span>.speed += <span class="number">2.5</span>;</div><div class="line">			<span class="keyword">this</span>.move();</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"加速，加速~"</span>);</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.len % <span class="number">6</span> == <span class="number">0</span> && <span class="keyword">this</span>.len &lt; <span class="number">60</span>) {</div><div class="line">			<span class="keyword">this</span>.addObject(<span class="string">"block"</span>);</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"增加难度啦~"</span>);</div><div class="line">		}</div><div class="line">		<span class="keyword">this</span>.len += <span class="number">1</span>;</div><div class="line">	}<span class="keyword">else</span>{<span class="comment">//没有吃食物</span></div><div class="line">		<span class="keyword">var</span> tail = <span class="keyword">this</span>.snake_pos.pop();</div><div class="line">		<span class="keyword">this</span>.carrier[tail[<span class="number">0</span>]][tail[<span class="number">1</span>]] = <span class="string">""</span>;</div><div class="line">		<span class="keyword">this</span>.gridElems[tail[<span class="number">0</span>]][tail[<span class="number">1</span>]].className = <span class="literal">false</span>;		</div><div class="line">	}</div><div class="line">	<span class="comment">//最后向前动一步，上面已经对是否吃食处理</span></div><div class="line">	<span class="keyword">this</span>.snake_pos.unshift([headX, headY]);</div><div class="line">	<span class="keyword">this</span>.carrier[headX][headY] = <span class="string">"cover"</span>;</div><div class="line">	<span class="keyword">this</span>.gridElems[headX][headY].className = <span class="string">"cover"</span>;</div><div class="line">	<span class="keyword">this</span>.direction_changed = <span class="literal">false</span>;		</div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">window.onkeydown = function(e){</div><div class="line">	//对空格的暂停/开始动作的响应</div><div class="line">	if (snake_obj.snake_pos && snake_obj.status) {</div><div class="line">		if (e.keyCode == 32) {</div><div class="line">			if (snake_obj.pause) {</div><div class="line">				snake_obj.pause = false;</div><div class="line">				snake_obj.talk(<span class="string">"游戏重新开始啦~"</span>);</div><div class="line">				snake_obj.move();</div><div class="line">			} else{</div><div class="line">				snake_obj.pause = true;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	//捕获下一步的方向</div><div class="line">	var bool = (e.keyCode &gt; 36 && e.keyCode &lt; 41 && Math.abs(e.keyCode - snake_obj.directionkey) != 2);</div><div class="line">	snake_obj.directionkey = (bool && !snake_obj.direction_changed) ? e.keyCode:snake_obj.directionkey;</div><div class="line">	//保证方向键在被执行后才能修改</div><div class="line">	if(bool && !snake_obj.direction_changed){</div><div class="line">		snake_obj.direction_changed = true;</div><div class="line">	}</div><div class="line">	return;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>　　上面的第一块代码就是步进程序，里面的每一小块代码前都有一行注释说明功能，有些我没有提到的功能是最后我加入的，现在可以不关注，你只要理解我上面提到的逻辑。后一块是按键响应代码，基本的是捕获下一步的方向，其他的是我做的优化，包括暂停功能。此处还修改了一个小<code>bug</code>，这个bug是在蛇长度只有3格的时候，你快速的按键会使游戏结束，原因是撞到了自己（见下图）。<strong>这个结果是由捕获程序造成的，虽然它禁止了蛇身的方向，但是它的判断机制是与现在的记录方向相比，所以你快速切换两次方向就可以换到错误的方向</strong>，而修正的方法也很简单，那就是在没有响应前一个准确按键前不能响应下一个按键。<br>　　　　　　　　<img src="http://whj-img.qiniudn.com/tanchishe_bug.png" alt="原有bug展示">　<br>　　上面的想法已经可以让蛇平稳的走出第一步了，但是，我们的游戏需要不断的继续下去，所以光走一步是不行的，我们需要让它不断的走下去，直到游戏结束，也就是撞边界或者自己的身体。这个我们就需要定时的调用让它走一步的方法，来实现不断的前进的效果。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.move = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.snakeTimer) {</div><div class="line">		<span class="built_in">window</span>.clearInterval(<span class="keyword">this</span>.snakeTimer);</div><div class="line">	}</div><div class="line">	<span class="keyword">this</span>.snakeTimer = <span class="built_in">window</span>.setInterval(self.step, <span class="built_in">Math</span>.floor(<span class="number">3000</span> / self.speed));</div><div class="line">}</div></pre></td></tr></table></figure>

<p>　　该段程序很简单，就是给步进程序设置一个定时器，不断的执行。细心的同学肯定注意到了我们在这段代码了使用了<code>bind</code>，这是什么？简单来说这是为了在<code>window.setInterval()</code>中使用类内的方法而不出错，细节我会另写一篇博客记录。好了，到这里我们的游戏的基础逻辑都完整了。</p>
<h2 id="第五步">第五步</h2>
<p>　　终于到最后一步了，但是也不能掉以轻心。其实这一段的内容已经写在上一部分了，你可以回去看步进的程序代码，里面有一段<code>加入一些随机元素</code>的代码，其实也就是增加一些娱乐性，基本的原理就是在游戏过程中判断并修改游戏的参数，增加游戏乐趣，由于我也只是初学者，只是模仿加了一些简单的元素，在此也就不赘述了，大家看一下就可以。</p>
<h2 id="写在最后">写在最后</h2>
<p>　　文章结尾我把整个js代码贴出来，大家可以整体看一下，弥补一下上面局部逻辑中表述不全面的部分，这样更有利于整体的理解。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//common</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span><span class="params">(id)</span></span>{</div><div class="line">	<span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//global</span></div><div class="line"><span class="keyword">var</span> len = <span class="number">3</span>;</div><div class="line"><span class="keyword">var</span> speed = <span class="number">10</span>;</div><div class="line"><span class="keyword">var</span> directionkey = <span class="number">39</span>; <span class="comment">//37-40左上右下</span></div><div class="line"><span class="keyword">var</span> WIDTH = <span class="number">50</span>;</div><div class="line"><span class="keyword">var</span> HEIGHT = <span class="number">20</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">	<span class="keyword">var</span> size = <span class="built_in">document</span>.getElementsByName(<span class="string">"size"</span>);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; size.length; i++) {</div><div class="line">		<span class="keyword">if</span> (size[i].checked) {</div><div class="line"><span class="comment">//			window.alert(size[i].value);</span></div><div class="line">			WIDTH = <span class="built_in">parseInt</span>(size[i].value);</div><div class="line">		}</div><div class="line">	}	</div><div class="line">	<span class="keyword">var</span> snake_obj = <span class="keyword">new</span> snake(len, speed, directionkey, WIDTH, HEIGHT, <span class="string">"say"</span>);<span class="comment">//生成一个对象</span></div><div class="line">	snake_obj.initGrid(<span class="string">"snakeWrap"</span>);<span class="comment">//生成游戏区域</span></div><div class="line">	</div><div class="line">	<span class="keyword">var</span> btnStart = $(<span class="string">"btnStart"</span>);</div><div class="line">	btnStart.onclick = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">		btnStart.blur(); <span class="comment">//firefox中必须释放焦点</span></div><div class="line">		snake_obj.clearAll();<span class="comment">//重置数据</span></div><div class="line">		<span class="comment">//重新生成区域，获取页面设置值</span></div><div class="line">		<span class="keyword">var</span> size = <span class="built_in">document</span>.getElementsByName(<span class="string">"size"</span>);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; size.length; i++) {</div><div class="line">			<span class="keyword">if</span> (size[i].checked) {</div><div class="line"><span class="comment">//				window.alert(size[i].value);</span></div><div class="line">				snake_obj.WIDTH = <span class="built_in">parseInt</span>(size[i].value);</div><div class="line">			}</div><div class="line">		}</div><div class="line">		snake_obj.initGrid(<span class="string">"snakeWrap"</span>);</div><div class="line">		</div><div class="line">		startgame(snake_obj);</div><div class="line">		btnStart.setAttribute(<span class="string">"disabled"</span>, <span class="literal">true</span>);</div><div class="line">		btnStart.style.color = <span class="string">"#aaa"</span>;</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="built_in">window</span>.onkeydown = <span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>{</div><div class="line">		<span class="keyword">if</span> (snake_obj.snake_pos && snake_obj.status) {</div><div class="line">			<span class="keyword">if</span> (e.keyCode == <span class="number">32</span>) {</div><div class="line">				<span class="keyword">if</span> (snake_obj.pause) {</div><div class="line">					snake_obj.pause = <span class="literal">false</span>;</div><div class="line">					snake_obj.talk(<span class="string">"游戏重新开始啦~"</span>);</div><div class="line">					snake_obj.move();</div><div class="line">				} <span class="keyword">else</span>{</div><div class="line">					snake_obj.pause = <span class="literal">true</span>;</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">		</div><div class="line">		<span class="keyword">var</span> bool = (e.keyCode &gt; <span class="number">36</span> && e.keyCode &lt; <span class="number">41</span> && <span class="built_in">Math</span>.abs(e.keyCode - snake_obj.directionkey) != <span class="number">2</span>);</div><div class="line">		snake_obj.directionkey = (bool && !snake_obj.direction_changed) ? e.keyCode:snake_obj.directionkey;</div><div class="line">		<span class="comment">//保证方向键在被执行后才能修改，否则可能会有bug，比如身体长度为3时可能撞到自己</span></div><div class="line">		<span class="keyword">if</span>(bool && !snake_obj.direction_changed){</div><div class="line">			snake_obj.direction_changed = <span class="literal">true</span>;</div><div class="line">		}</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">startgame</span><span class="params">(obj)</span></span>{</div><div class="line">	obj.initSnake();</div><div class="line">	obj.addObject(<span class="string">"food"</span>);</div><div class="line">	obj.move();	</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//定义类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">snake</span><span class="params">(l, s, d, W, H, t)</span></span>{</div><div class="line">	<span class="keyword">this</span>.len = l;</div><div class="line">	<span class="keyword">this</span>.speed = s;</div><div class="line">	<span class="keyword">this</span>.directionkey = d;</div><div class="line">	<span class="keyword">this</span>.WIDTH = W;</div><div class="line">	<span class="keyword">this</span>.HEIGHT = H;</div><div class="line">	<span class="keyword">this</span>.gridElems = multiArray(H, W); <span class="comment">//关联html中要控制的表格对象</span></div><div class="line">	<span class="keyword">this</span>.carrier = multiArray(H, W); <span class="comment">//用来记录表格的格点使用情况</span></div><div class="line">	<span class="keyword">this</span>.snake_pos;</div><div class="line">	<span class="keyword">this</span>.snakeTimer;</div><div class="line">	<span class="keyword">this</span>.score = <span class="number">0</span>;</div><div class="line">	<span class="keyword">this</span>.talk_id = t; <span class="comment">//绑定界面上用来显示对话的窗口的id</span></div><div class="line">	<span class="keyword">this</span>.brakeTimers = [];</div><div class="line">	<span class="keyword">this</span>.skateTimers = [];</div><div class="line">	<span class="keyword">this</span>.direction_changed = <span class="literal">false</span>; <span class="comment">//当前按钮是否被执行</span></div><div class="line">	<span class="keyword">this</span>.pause = <span class="literal">false</span>; <span class="comment">//当前是否在停止状态</span></div><div class="line">	<span class="keyword">this</span>.status = <span class="literal">true</span>; <span class="comment">//当前是否在正常游戏状态，撞墙后则设置为false</span></div><div class="line">	<span class="keyword">this</span>.table;</div><div class="line">		</div><div class="line">	<span class="keyword">this</span>.initGrid = <span class="function"><span class="keyword">function</span><span class="params">(target)</span></span>{</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.table) {</div><div class="line">			$(target).removeChild(<span class="keyword">this</span>.table);</div><div class="line">		}</div><div class="line">		<span class="keyword">this</span>.table = <span class="built_in">document</span>.createElement(<span class="string">"table"</span>);</div><div class="line">		<span class="keyword">var</span> tbody = <span class="built_in">document</span>.createElement(<span class="string">"tbody"</span>);		</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.HEIGHT; i++) {</div><div class="line">			<span class="keyword">var</span> row = <span class="built_in">document</span>.createElement(<span class="string">"tr"</span>);</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="keyword">this</span>.WIDTH; j++) {</div><div class="line">				<span class="keyword">var</span> col = <span class="built_in">document</span>.createElement(<span class="string">"td"</span>);</div><div class="line">				row.appendChild(col);</div><div class="line">				<span class="keyword">this</span>.gridElems[i][j] = col;</div><div class="line">			}</div><div class="line">			tbody.appendChild(row);</div><div class="line">		}</div><div class="line">		<span class="keyword">this</span>.table.appendChild(tbody);</div><div class="line">		$(target).appendChild(<span class="keyword">this</span>.table);</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.initSnake = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>{</div><div class="line">		<span class="keyword">this</span>.talk(<span class="string">"贪吃蛇游戏开始啦~"</span>);</div><div class="line">		$(<span class="string">"score"</span>).innerHTML = <span class="keyword">this</span>.score;</div><div class="line">		<span class="keyword">this</span>.snake_pos = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line">		<span class="keyword">var</span> snake_head_dot = randdot(<span class="keyword">this</span>.carrier, <span class="number">0</span>, <span class="keyword">this</span>.len - <span class="number">1</span>, <span class="keyword">this</span>.HEIGHT, <span class="built_in">Math</span>.floor(WIDTH/<span class="number">2</span>));</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.len; i++) {</div><div class="line">			<span class="keyword">var</span> x = snake_head_dot[<span class="number">0</span>];</div><div class="line">			<span class="keyword">var</span> y = snake_head_dot[<span class="number">1</span>] - i;</div><div class="line">			<span class="keyword">this</span>.snake_pos.push([x, y]);</div><div class="line">			<span class="keyword">this</span>.carrier[x][y] = <span class="string">"cover"</span>;</div><div class="line">			<span class="keyword">this</span>.gridElems[x][y].className = <span class="string">"cover"</span>;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.addObject = <span class="function"><span class="keyword">function</span><span class="params">(type)</span></span>{</div><div class="line">		<span class="keyword">var</span> pos = randdot(<span class="keyword">this</span>.carrier);</div><div class="line">		<span class="keyword">this</span>.carrier[pos[<span class="number">0</span>]][pos[<span class="number">1</span>]] = type;</div><div class="line">		<span class="keyword">this</span>.gridElems[pos[<span class="number">0</span>]][pos[<span class="number">1</span>]].className = type;</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.step = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>{</div><div class="line">		<span class="comment">//判断现在是否在暂停状态</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.pause) {</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"暂停啦，休息一下~"</span>);</div><div class="line">			<span class="built_in">window</span>.clearInterval(<span class="keyword">this</span>.snakeTimer);</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.brakeTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.brakeTimers[i]);</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.skateTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.skateTimers[i]);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		}</div><div class="line">		<span class="comment">//取得现在的头节点</span></div><div class="line">		<span class="keyword">var</span> headX = <span class="keyword">this</span>.snake_pos[<span class="number">0</span>][<span class="number">0</span>];</div><div class="line">		<span class="keyword">var</span> headY = <span class="keyword">this</span>.snake_pos[<span class="number">0</span>][<span class="number">1</span>];</div><div class="line">		<span class="comment">//加入一些随机元素</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.len &gt;= <span class="number">10</span> && <span class="keyword">this</span>.brakeTimers.length &lt;= <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.len /<span class="number">2</span>)) {</div><div class="line">				<span class="keyword">this</span>.brakeTimers.push(<span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">					<span class="keyword">this</span>.addObject(<span class="string">"brake"</span>).bind(<span class="keyword">this</span>)</div><div class="line">				}, randNum(<span class="number">5000</span>, <span class="number">50000</span>)));</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.skateTimers.length &lt;= <span class="number">5</span> || <span class="keyword">this</span>.skateTimers.length &gt;=  <span class="number">35</span>) {</div><div class="line">			<span class="keyword">this</span>.skateTimers.push(<span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">				<span class="keyword">this</span>.addObject(<span class="string">"skate"</span>).bind(<span class="keyword">this</span>)</div><div class="line">			}, randNum(<span class="number">5000</span>, <span class="number">50000</span>)));</div><div class="line">		}		</div><div class="line">		<span class="comment">//根据方向取得下一步头节点坐标</span></div><div class="line">		<span class="keyword">switch</span> (<span class="keyword">this</span>.directionkey){</div><div class="line">			<span class="keyword">case</span> <span class="number">37</span>:<span class="comment">//左下右上</span></div><div class="line">				headY -= <span class="number">1</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			<span class="keyword">case</span> <span class="number">38</span>:</div><div class="line">				headX -= <span class="number">1</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			<span class="keyword">case</span> <span class="number">39</span>:</div><div class="line">				headY += <span class="number">1</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			<span class="keyword">case</span> <span class="number">40</span>:</div><div class="line">				headX += <span class="number">1</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">		}</div><div class="line">		<span class="comment">//针对头节点撞墙和撞自己</span></div><div class="line">		<span class="keyword">if</span>(headX &lt; <span class="number">0</span> || headX &gt;= <span class="keyword">this</span>.HEIGHT || headY &lt; <span class="number">0</span> || headY &gt;= <span class="keyword">this</span>.WIDTH || <span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"cover"</span> || <span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"block"</span> ){			</div><div class="line">			<span class="comment">//撞墙后则进入非正常状态，为暂停和死亡的区分</span></div><div class="line">			<span class="keyword">this</span>.status = <span class="literal">false</span>;</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"你撞到东西啦~游戏结束！"</span>);</div><div class="line">			<span class="comment">//设置最高分</span></div><div class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.score &gt;= <span class="built_in">parseInt</span>($(<span class="string">"best_score"</span>).innerHTML)) {</div><div class="line">				$(<span class="string">"best_score"</span>).innerHTML = <span class="keyword">this</span>.score;</div><div class="line">			}			</div><div class="line">			$(<span class="string">"btnStart"</span>).removeAttribute(<span class="string">"disabled"</span>);</div><div class="line">			$(<span class="string">"btnStart"</span>).style.color = <span class="string">"#000"</span>;</div><div class="line">			<span class="comment">//清除定时器</span></div><div class="line">			<span class="built_in">window</span>.clearInterval(<span class="keyword">this</span>.snakeTimer);</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.brakeTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.brakeTimers[i]);</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.skateTimers.length; i++) <span class="built_in">window</span>.clearTimeout(<span class="keyword">this</span>.skateTimers[i]);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		}</div><div class="line">		<span class="comment">//捡到刹车</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"brake"</span> ) {</div><div class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.speed &gt;= <span class="number">20</span>) {</div><div class="line">				<span class="keyword">this</span>.speed -= <span class="number">10</span>;</div><div class="line">				<span class="keyword">this</span>.move();</div><div class="line">				<span class="keyword">this</span>.talk(<span class="string">"慢一点，步子太快会扯着蛋~"</span>);</div><div class="line">			}<span class="keyword">else</span>{</div><div class="line">				<span class="keyword">this</span>.talk(<span class="string">"已经很慢啦，不能再减速了~"</span>);</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="comment">//遭遇滑板</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"skate"</span> ) {</div><div class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.speed &lt;= <span class="number">50</span>) {</div><div class="line">				<span class="keyword">this</span>.speed += <span class="number">10</span>;</div><div class="line">				<span class="keyword">this</span>.move();</div><div class="line">				<span class="keyword">this</span>.talk(<span class="string">"带你飞~"</span>);</div><div class="line">			} <span class="keyword">else</span>{</div><div class="line">				<span class="keyword">this</span>.talk(<span class="string">"不能再快啦~"</span>);</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="comment">//如果吃到食物</span></div><div class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.carrier[headX][headY] == <span class="string">"food"</span>){</div><div class="line">			<span class="keyword">this</span>.talk(<span class="string">"吃到食物啦~"</span>);</div><div class="line">			<span class="keyword">this</span>.score += <span class="number">1</span>;</div><div class="line">			$(<span class="string">"score"</span>).innerHTML = <span class="keyword">this</span>.score;</div><div class="line">			<span class="comment">//清除旧食物，添加新食物，加分</span></div><div class="line">			<span class="keyword">this</span>.carrier[headX][headY] = <span class="string">''</span>;</div><div class="line">			<span class="keyword">this</span>.gridElems[headX][headY].className = <span class="string">""</span>;</div><div class="line">			<span class="keyword">this</span>.addObject(<span class="string">"food"</span>);</div><div class="line">			<span class="comment">//满足一定条件则加速，并重置定时器</span></div><div class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.len % <span class="number">4</span> == <span class="number">0</span> && <span class="keyword">this</span>.speed &lt; <span class="number">60</span>) {</div><div class="line">				<span class="keyword">this</span>.speed += <span class="number">2.5</span>;</div><div class="line">				<span class="keyword">this</span>.move();</div><div class="line">				<span class="keyword">this</span>.talk(<span class="string">"加速，加速~"</span>);</div><div class="line">			}</div><div class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.len % <span class="number">6</span> == <span class="number">0</span> && <span class="keyword">this</span>.len &lt; <span class="number">60</span>) {</div><div class="line">				<span class="keyword">this</span>.addObject(<span class="string">"block"</span>);</div><div class="line">				<span class="keyword">this</span>.talk(<span class="string">"增加难度啦~"</span>);</div><div class="line">			}</div><div class="line">			<span class="keyword">this</span>.len += <span class="number">1</span>;</div><div class="line">		}<span class="keyword">else</span>{<span class="comment">//没有吃食物</span></div><div class="line">			<span class="keyword">var</span> tail = <span class="keyword">this</span>.snake_pos.pop();</div><div class="line">			<span class="keyword">this</span>.carrier[tail[<span class="number">0</span>]][tail[<span class="number">1</span>]] = <span class="string">""</span>;</div><div class="line">			<span class="keyword">this</span>.gridElems[tail[<span class="number">0</span>]][tail[<span class="number">1</span>]].className = <span class="literal">false</span>;		</div><div class="line">		}</div><div class="line">		<span class="comment">//最后向前动一步，上面已经对是否吃食处理</span></div><div class="line">		<span class="keyword">this</span>.snake_pos.unshift([headX, headY]);</div><div class="line">		<span class="keyword">this</span>.carrier[headX][headY] = <span class="string">"cover"</span>;</div><div class="line">		<span class="keyword">this</span>.gridElems[headX][headY].className = <span class="string">"cover"</span>;</div><div class="line">		<span class="keyword">this</span>.direction_changed = <span class="literal">false</span>;</div><div class="line">		</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.move = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.snakeTimer) {</div><div class="line">			<span class="built_in">window</span>.clearInterval(<span class="keyword">this</span>.snakeTimer);</div><div class="line">		}</div><div class="line">		<span class="keyword">this</span>.snakeTimer = <span class="built_in">window</span>.setInterval(<span class="keyword">this</span>.step.bind(<span class="keyword">this</span>), <span class="built_in">Math</span>.floor(<span class="number">3000</span> / <span class="keyword">this</span>.speed));</div><div class="line"></div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.talk = <span class="function"><span class="keyword">function</span><span class="params">(sth)</span></span>{</div><div class="line">		$(<span class="keyword">this</span>.talk_id).innerHTML = sth;</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.clearAll = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{<span class="comment">//把记录清空，把图像恢复，参数重置</span></div><div class="line">		<span class="keyword">this</span>.len = <span class="number">3</span>;</div><div class="line">		<span class="keyword">this</span>.speed = <span class="number">10</span>;</div><div class="line">		<span class="keyword">this</span>.directionkey = <span class="number">39</span>;</div><div class="line">		<span class="keyword">this</span>.score = <span class="number">0</span>;	</div><div class="line">		<span class="keyword">this</span>.status = <span class="literal">true</span>;</div><div class="line">		<span class="keyword">this</span>.pause = <span class="literal">false</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.HEIGHT; i++) {</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="keyword">this</span>.WIDTH; j++) {</div><div class="line">				<span class="keyword">this</span>.carrier[i][j] = <span class="literal">false</span>;</div><div class="line">				<span class="keyword">this</span>.gridElems[i][j].className = <span class="string">""</span>;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">randNum</span><span class="params">(start, end)</span></span>{</div><div class="line">		<span class="keyword">return</span> (<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (end - start)) + start);</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">randdot</span><span class="params">(carrier, startX, startY, endX, endY)</span></span>{</div><div class="line">		startX = startX || <span class="number">0</span>;</div><div class="line">		startY = startY || <span class="number">0</span>;</div><div class="line">		endX = endX || <span class="keyword">this</span>.HEIGHT;</div><div class="line">		endY = endY || <span class="keyword">this</span>.WIDTH;</div><div class="line">		<span class="keyword">var</span> x = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (endX - startX)) + startX;</div><div class="line">		<span class="keyword">var</span> y = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (endY - startY)) + startY;</div><div class="line">		<span class="keyword">var</span> dot = [x, y];</div><div class="line">		<span class="keyword">if</span> (carrier[x][y]) {</div><div class="line">			<span class="keyword">return</span> randdot(carrier, startX, startY, endX, endY);</div><div class="line">		}</div><div class="line">		<span class="keyword">return</span> dot;</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">multiArray</span><span class="params">(m, n)</span> </span>{ <span class="comment">//创建m*n的二维数组，即矩阵</span></div><div class="line">		<span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(m);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; m; i++) {</div><div class="line">			arr[i] = <span class="keyword">new</span> <span class="built_in">Array</span>(n);</div><div class="line">		}</div><div class="line">		<span class="keyword">return</span> arr;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>　　上面的就是所有的代码了，比起前面的游戏逻辑，其中还有一些基本的操作，比如：在页面加载完成后对一些按钮绑定一些操作等等，这些都不是本文的重点。大家可以看到，用类封装后，基本的操作就只需要调用类的方法了，而所有的属性也都存储在类之中，获取都很有针对性，而作为主函数的<code>startgame</code>非常的简单，根本不用考虑具体实现，优势立现。</p>
<p>版权：本文采用以下协议进行授权，<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" rel="external">自由转载 - 非商用 - 非衍生 - 保持署名 | Creative Commons BY-NC-ND 3.0</a>，转载请注明作者及出处。　
　　</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/12/05/2014-12-05-202747/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          javascript中的bind
        
      </div>
    </a>
  
  
    <a href="/2014/12/02/2014-12-02-201531/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">HTML+CSS+JS实现的贪吃蛇游戏&lt;一&gt;</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2014-12-03-102647" data-title="HTML+CSS+JS实现的贪吃蛇游戏&lt;二&gt;（完）" data-url="http://yoursite.com/2014/12/03/2014-12-03-102647/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"whjgithub"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 WHJ
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

  <script src="/js/main.js" type="text/javascript"></script>


  </div>
</body>
</html>